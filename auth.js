import{db,saveDb}from"./db.js";import{wrapWithLayout}from"./layout.js";import*as exportUtils from"./export.js";export function renderLogin(n,e="users"){const r="admin"===e,t=`\n    <style>\n      .thynktech-login-container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        min-height: 100vh;\n        background: linear-gradient(135deg, \n          ${r?"#2196f3 0%, #1976d2 25%, #ffd700 50%, #eaf6fb 100%":"#6ec6ff 0%, #2196f3 25%, #81d4fa 50%, #f5fafd 100%"});\n        position: relative;\n        overflow: hidden;\n      }\n      \n      .thynktech-login-container::before {\n        content: '';\n        position: absolute;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background: radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.1) 0%, transparent 50%),\n                    radial-gradient(circle at 80% 20%, rgba(33, 150, 243, 0.1) 0%, transparent 50%);\n        pointer-events: none;\n      }\n      \n      .thynktech-login-card {\n        background: rgba(255, 255, 255, 0.95);\n        border-radius: 24px;\n        box-shadow: \n          0 20px 60px rgba(33, 150, 243, 0.15),\n          0 10px 30px rgba(0, 0, 0, 0.1);\n        padding: 3rem 2.5rem;\n        width: 100%;\n        max-width: 440px;\n        backdrop-filter: blur(15px);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n        position: relative;\n        z-index: 1;\n      }\n      \n      .thynktech-login-header {\n        text-align: center;\n        margin-bottom: 2.5rem;\n      }\n      \n      .thynktech-login-header .logo {\n        font-size: 3rem;\n        margin-bottom: 1rem;\n      }\n      \n      .thynktech-login-header h1 {\n        color: ${r?"#1976d2":"#2196f3"};\n        font-size: 1.8rem;\n        font-weight: 700;\n        margin: 0.5rem 0 0.5rem;\n        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n      }\n      \n      .thynktech-login-header p {\n        color: #666;\n        font-size: 1rem;\n        margin: 0;\n        font-weight: 400;\n        opacity: 0.8;\n      }\n      \n      .form-blue-label {\n        color: ${r?"#1976d2":"#2196f3"};\n        font-weight: 600;\n        margin-bottom: 0.5rem;\n        display: block;\n        font-size: 0.95rem;\n      }\n      \n      .form-blue-input {\n        width: 100%;\n        padding: 1rem 1.2rem;\n        border: 2px solid #e3f2fd;\n        border-radius: 12px;\n        background: rgba(255, 255, 255, 0.9);\n        font-size: 1rem;\n        margin-bottom: 1.5rem;\n        transition: all 0.3s ease;\n        color: #222;\n        box-sizing: border-box;\n      }\n      \n      .form-blue-input:focus {\n        border-color: ${r?"#1976d2":"#2196f3"};\n        outline: none;\n        box-shadow: 0 0 0 4px ${r?"rgba(25, 118, 210, 0.1)":"rgba(33, 150, 243, 0.1)"};\n        background: rgba(255, 255, 255, 1);\n      }\n      \n      .form-blue-btn-main {\n        width: 100%;\n        background: ${r?"linear-gradient(45deg, #1976d2, #ffd700)":"linear-gradient(45deg, #2196f3, #81d4fa)"};\n        color: #fff;\n        border: none;\n        border-radius: 12px;\n        padding: 1rem;\n        font-weight: 600;\n        font-size: 1.1rem;\n        margin-top: 1.5rem;\n        cursor: pointer;\n        transition: all 0.3s ease;\n        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);\n        box-shadow: 0 4px 15px ${r?"rgba(25, 118, 210, 0.3)":"rgba(33, 150, 243, 0.3)"};\n      }\n      \n      .form-blue-btn-main:hover {\n        background: ${r?"linear-gradient(45deg, #ffd700, #1976d2)":"linear-gradient(45deg, #81d4fa, #2196f3)"};\n        transform: translateY(-2px);\n        box-shadow: 0 8px 25px ${r?"rgba(25, 118, 210, 0.4)":"rgba(33, 150, 243, 0.4)"};\n      }\n      \n      \n      .thynktech-import-section {\n        border-top: 1px solid #e3f2fd;\n        padding-top: 2rem;\n        margin-top: 2rem;\n      }\n      \n      .thynktech-btn-import {\n        width: 100%;\n        padding: 1rem;\n        background: linear-gradient(45deg, #e3f2fd, #b3e0fc);\n        border: none;\n        border-radius: 12px;\n        color: #2196f3;\n        font-weight: 600;\n        font-size: 1rem;\n        transition: all 0.3s ease;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        gap: 10px;\n        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);\n      }\n      \n      .thynktech-btn-import:hover {\n        background: linear-gradient(45deg, #b3e0fc, #81d4fa);\n        transform: translateY(-2px);\n        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);\n      }\n      \n      .thynktech-error-message {\n        background: rgba(220, 53, 69, 0.1);\n        border: 1px solid rgba(220, 53, 69, 0.3);\n        color: #dc3545;\n        padding: 1rem;\n        border-radius: 10px;\n        margin-top: 1.5rem;\n        font-size: 0.95rem;\n      }\n      \n      .thynktech-success-message {\n        background: rgba(25, 135, 84, 0.1);\n        border: 1px solid rgba(25, 135, 84, 0.3);\n        color: #198754;\n        padding: 1rem;\n        border-radius: 10px;\n        margin-top: 1.5rem;\n        font-size: 0.95rem;\n      }\n      \n      @media (max-width: 768px) {\n        .thynktech-login-container {\n          padding: 1rem;\n        }\n        .thynktech-login-card {\n          padding: 2rem 1.5rem;\n          max-width: 100%;\n        }\n      }\n    </style>\n    \n    <div class="thynktech-login-container">\n      <div class="thynktech-login-card">\n        <div class="thynktech-login-header">\n          <div class="logo">üá¨üá≠</div>\n          <h1>${r?"ThynkTech Admin":"ThynkTech Users"}</h1>\n          <p>${r?"Administrative Healthcare Management":"Professional Healthcare Management"}</p>\n        </div>\n        \n        <form id="loginForm">\n          <label class="form-blue-label" for="username">Email Address</label>\n          <input type="text" id="username" name="username" class="form-blue-input" required autocomplete="username">\n          \n          <label class="form-blue-label" for="password">Password</label>\n          <input type="password" id="password" name="password" class="form-blue-input" required autocomplete="current-password">\n          \n          <button type="submit" class="form-blue-btn-main">\n            ${r?"üîê Admin Login":"üë§ User Login"}\n          </button>\n        </form>\n        \n        ${r?"":'\n        <div class="thynktech-import-section" id="importSection">\n          <button type="button" class="thynktech-btn-import" onclick="showImportOptions()">\n            üîß Member Data Import Setup\n          </button>\n        </div>\n        '}\n        \n        <div id="loginMessage"></div>\n      </div>\n    </div>\n  `;n.innerHTML=t,document.getElementById("loginForm").onsubmit=function(n){n.preventDefault();const e=this.username.value.trim(),r=this.password.value,t=db.users.find(n=>n.username===e&&n.password===r);if(t)db.currentUser=t,saveDb(),t.role&&"admin"===t.role.toLowerCase()?window.location.hash="#admin-dashboard":window.location.hash="#user-dashboard";else{const n=document.getElementById("loginMessage");n.innerHTML='<div class="thynktech-error-message">Invalid username or password! Please check your credentials.</div>',setTimeout(()=>{n.innerHTML=""},5e3)}},shouldShowImport&&(document.getElementById("importSection").style.display="block"),window.showImportOptions=function(){if(!shouldShowImport)return;const n=document.createElement("input");n.type="file",n.accept="application/json",n.onchange=function(n){const e=n.target.files[0];if(!e)return;const r=new FileReader;r.onload=function(n){try{const e=JSON.parse(n.target.result);if(!e.users||!e.registers)throw new Error("Invalid setup file");db.facility=e.facility||{},db.settings=e.settings||{},db.users=e.users||[],db.registers=e.registers||[],db.roles=e.roles||[],db.servicesList=e.servicesList||[],db.customPatientFields=e.customPatientFields||[],saveDb();document.getElementById("loginMessage").innerHTML='<div class="thynktech-success-message">‚úÖ Setup imported successfully! You can now log in with your credentials.</div>'}catch(n){document.getElementById("loginMessage").innerHTML='<div class="thynktech-error-message">‚ùå Import failed: Invalid or corrupted setup file.</div>'}},r.readAsText(e)},n.click()}}