import{db,saveDb}from"./db.js";function getServicesList(){return(db.registers||[]).map(t=>t.name)}export function renderVisitLog(t){const e=db.visits||[];t.innerHTML=`\n    <div class="container my-4">\n      <div class="d-flex align-items-center justify-content-between">\n        <h4><i class="bi bi-journal-text"></i> Visits Logged</h4>\n      </div>\n      <div class="card shadow-sm mt-4">\n        <div class="card-body p-2">\n          <table class="table table-bordered table-sm mb-0">\n            <thead>\n              <tr>\n                <th>Date</th>\n                <th>Patient</th>\n                <th>Service(s)</th>\n                <th>Provider</th>\n                <th>Notes</th>\n              </tr>\n            </thead>\n            <tbody>\n              ${e.length?e.map(t=>`\n                <tr>\n                  <td>${t.visitDate||""}</td>\n                  <td>${t.patientID||""}</td>\n                  <td>${Array.isArray(t.serviceType)?t.serviceType.join(", "):t.serviceType||""}</td>\n                  <td>${t.loggedBy||""}</td>\n                  <td>${t.notes||""}</td>\n                </tr>\n              `).join(""):'<tr><td colspan="5" class="text-center text-muted">No visits logged yet.</td></tr>'}\n            </tbody>\n          </table>\n        </div>\n      </div>\n      <a href="#admin-dashboard" class="btn btn-link mt-2"><i class="bi bi-arrow-left"></i> Back</a>\n    </div>\n  `}export function createVisitForm(t,e){const n=document.createElement("div");n.className="visit-form my-3";const i=getServicesList();n.innerHTML=`\n    <form class="row g-2">\n      <div class="col-md-4">\n        <select class="form-select" multiple required size="4">\n          ${i.length?i.map(t=>`<option value="${t}">${t}</option>`).join(""):"<option disabled>No services available</option>"}\n        </select>\n      </div>\n      <div class="col-md-3">\n        <input type="date" class="form-control" max="${(new Date).toISOString().slice(0,10)}" value="${(new Date).toISOString().slice(0,10)}">\n      </div>\n      <div class="col-md-2">\n        <button class="btn btn-success w-100" type="submit"><i class="bi bi-check2-circle"></i> Save</button>\n      </div>\n    </form>\n    <div class="visit-msg mt-2"></div>\n  `;const s=n.querySelector("form");return s.onsubmit=function(i){i.preventDefault();const r=Array.from(s.querySelector("select").selectedOptions).map(t=>t.value),a=s.querySelector("input").value;if(!r.length)return void(n.querySelector(".visit-msg").innerHTML='<div class="alert alert-danger">Select a service</div>');const c={patientID:t.patientID,visitDate:a,serviceType:r,facility:db.facility?.name||"",loggedBy:db.currentUser?.username||"",timestamp:Date.now()};db.visits.push(c),saveDb(),n.querySelector(".visit-msg").innerHTML='<div class="alert alert-success">Visit logged!</div>',e&&e()},n}