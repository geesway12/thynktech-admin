import{db,saveDb,loadDb}from"./db.js";import{registerServiceWorker}from"./pwa.js";import{renderLogin}from"./auth.js";import{renderFacilitySetup,renderAdminDashboard,renderUserManagement,renderAdminExportBackupPage}from"./admin.js";import{renderProfile}from"./utils.profile.js";import{renderPatientList}from"./patients.js";import{renderVisitLog}from"./visits.js";import{renderRegisterMgmt}from"./registers.js";import{renderReports}from"./reports.js";import{renderServiceVisitSelector,renderServiceEntry}from"./services.js";import{renderAppointmentForm}from"./appointments.js";function router(){const e=document.getElementById("app");if(!db.facility)return window.location.hash="#facility-setup",void renderFacilitySetup(e);if(!db.users||0===db.users.length)return void(window.location.hash="#admin-setup");if(!db.currentUser)return window.location.hash="#login",void renderLogin(e);const r=window.location.hash;if("#facility-setup"===r)renderFacilitySetup(e);else if("#login"===r)renderLogin(e);else if("#admin-dashboard"===r||""===r)renderAdminDashboard(e);else if("#profile"===r)renderProfile(e,{dashboardHash:"#admin-dashboard",getUser:()=>db.currentUser,updateUser:e=>{const r=db.users.findIndex(r=>r.username===e.username);-1!==r&&(db.users[r]={...db.users[r],...e}),db.currentUser=e,saveDb()},fieldLabels:{fullName:"Full Name",contact:"Contact Number"}});else if("#user-mgmt"===r)renderUserManagement(e);else if("#patient-reg"===r)renderPatientList(e);else if("#visit-log"===r)renderVisitLog(e);else if("#register-mgmt"===r)renderRegisterMgmt(e);else if("#reports"===r)renderReports(e);else if("#admin-export"===r)renderAdminExportBackupPage(e);else if(r.startsWith("#appointment")){const i=r.split("-")[1],t=db.patients?.find(e=>e.patientID===i);t?renderAppointmentForm(t):renderAdminDashboard(e)}else r.startsWith("#service-entry")?renderServiceVisitSelector(e):renderAdminDashboard(e)}window.addEventListener("hashchange",router),window.addEventListener("load",()=>{loadDb(),registerServiceWorker(),router()});